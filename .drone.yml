---
kind: pipeline
name: matrix-1

platform:
  os: linux
  arch: amd64

workspace:
  base: /var/www/owncloud
  path: apps/contacts

steps:
- name: owncloud-coding-standard
  pull: always
  image: owncloudci/php:7.2
  commands:
  - make test-php-style

- name: notify
  pull: always
  image: plugins/slack:1
  settings:
    channel: builds
  environment:
    SLACK_WEBHOOK:
      from_secret: slack_webhook
  when:
    event:
    - push
    - tag
    status:
    - failure
    - changed

trigger:
  ref:
  - refs/tags/**
  - refs/pull/**
  - refs/pull-requests/**
  - refs/merge-requests/**
  - refs/heads/master
  - refs/heads/release*
  - refs/heads/release/*

---
kind: pipeline
name: matrix-2

platform:
  os: linux
  arch: amd64

workspace:
  base: /var/www/owncloud
  path: apps/contacts

steps:
- name: owncloud-coding-standard
  pull: always
  image: owncloudci/php:7.1
  commands:
  - make test-php-style

- name: notify
  pull: always
  image: plugins/slack:1
  settings:
    channel: builds
  environment:
    SLACK_WEBHOOK:
      from_secret: slack_webhook
  when:
    event:
    - push
    - tag
    status:
    - failure
    - changed

trigger:
  ref:
  - refs/tags/**
  - refs/pull/**
  - refs/pull-requests/**
  - refs/merge-requests/**
  - refs/heads/master
  - refs/heads/release*
  - refs/heads/release/*

---
kind: pipeline
name: matrix-3

platform:
  os: linux
  arch: amd64

workspace:
  base: /var/www/owncloud
  path: apps/contacts

steps:
- name: owncloud-coding-standard
  pull: always
  image: owncloudci/php:7.0
  commands:
  - make test-php-style

- name: notify
  pull: always
  image: plugins/slack:1
  settings:
    channel: builds
  environment:
    SLACK_WEBHOOK:
      from_secret: slack_webhook
  when:
    event:
    - push
    - tag
    status:
    - failure
    - changed

trigger:
  ref:
  - refs/tags/**
  - refs/pull/**
  - refs/pull-requests/**
  - refs/merge-requests/**
  - refs/heads/master
  - refs/heads/release*
  - refs/heads/release/*

---
kind: pipeline
name: matrix-4

platform:
  os: linux
  arch: amd64

workspace:
  base: /var/www/owncloud
  path: apps/contacts

steps:
- name: install-core
  pull: always
  image: owncloudci/core
  settings:
    db_host: sqlite
    db_name: owncloud
    db_password: owncloud
    db_type: sqlite
    db_username: autotest
    version: daily-master-qa

- name: install-app
  pull: always
  image: owncloudci/php:7.0
  commands:
  - make npm
  - cd /var/www/owncloud/
  - php occ a:l
  - php occ a:e contacts
  - php occ a:e testing
  - php occ a:l
  - php occ config:system:set trusted_domains 1 --value=owncloud
  - php occ log:manage --level 0

- name: js-tests
  pull: always
  image: owncloudci/php:7.0
  commands:
  - make test-js

- name: notify
  pull: always
  image: plugins/slack:1
  settings:
    channel: builds
  environment:
    SLACK_WEBHOOK:
      from_secret: slack_webhook
  when:
    event:
    - push
    - tag
    status:
    - failure
    - changed

services:
- name: selenium
  pull: always
  image: selenium/standalone-firefox-debug:latest

trigger:
  ref:
  - refs/tags/**
  - refs/pull/**
  - refs/pull-requests/**
  - refs/merge-requests/**
  - refs/heads/master
  - refs/heads/release*
  - refs/heads/release/*

---
kind: pipeline
name: matrix-5

platform:
  os: linux
  arch: amd64

workspace:
  base: /var/www/owncloud
  path: apps/contacts

steps:
- name: install-core
  pull: always
  image: owncloudci/core
  settings:
    db_host: sqlite
    db_name: owncloud
    db_password: owncloud
    db_type: sqlite
    db_username: autotest
    version: daily-master-qa

- name: install-app
  pull: always
  image: owncloudci/php:7.1
  commands:
  - make npm
  - cd /var/www/owncloud/
  - php occ a:l
  - php occ a:e contacts
  - php occ a:e testing
  - php occ a:l
  - php occ config:system:set trusted_domains 1 --value=owncloud
  - php occ log:manage --level 0

- name: js-tests
  pull: always
  image: owncloudci/php:7.1
  commands:
  - make test-js

- name: codecov-js
  pull: always
  image: plugins/codecov:2
  settings:
    paths:
    - coverage/*.info
  environment:
    CODECOV_TOKEN:
      from_secret: codecov_token

- name: notify
  pull: always
  image: plugins/slack:1
  settings:
    channel: builds
  environment:
    SLACK_WEBHOOK:
      from_secret: slack_webhook
  when:
    event:
    - push
    - tag
    status:
    - failure
    - changed

services:
- name: selenium
  pull: always
  image: selenium/standalone-firefox-debug:latest

trigger:
  ref:
  - refs/tags/**
  - refs/pull/**
  - refs/pull-requests/**
  - refs/merge-requests/**
  - refs/heads/master
  - refs/heads/release*
  - refs/heads/release/*

---
kind: pipeline
name: matrix-6

platform:
  os: linux
  arch: amd64

workspace:
  base: /var/www/owncloud
  path: apps/contacts

steps:
- name: install-core
  pull: always
  image: owncloudci/core
  settings:
    db_host: sqlite
    db_name: owncloud
    db_password: owncloud
    db_type: sqlite
    db_username: autotest
    version: daily-master-qa

- name: install-app
  pull: always
  image: owncloudci/php:7.1
  commands:
  - make npm
  - cd /var/www/owncloud/
  - php occ a:l
  - php occ a:e contacts
  - php occ a:e testing
  - php occ a:l
  - php occ config:system:set trusted_domains 1 --value=owncloud
  - php occ log:manage --level 0

- name: phpunit-tests
  pull: always
  image: owncloudci/php:7.1
  commands:
  - if [ -z "${COVERAGE}" ]; then make test-php-unit; fi
  - if [ "${COVERAGE}" = "true" ]; then make test-php-unit-dbg; fi
  environment:
    COVERAGE: ${COVERAGE}

- name: notify
  pull: always
  image: plugins/slack:1
  settings:
    channel: builds
  environment:
    SLACK_WEBHOOK:
      from_secret: slack_webhook
  when:
    event:
    - push
    - tag
    status:
    - failure
    - changed

trigger:
  ref:
  - refs/tags/**
  - refs/pull/**
  - refs/pull-requests/**
  - refs/merge-requests/**
  - refs/heads/master
  - refs/heads/release*
  - refs/heads/release/*

---
kind: pipeline
name: matrix-7

platform:
  os: linux
  arch: amd64

workspace:
  base: /var/www/owncloud
  path: apps/contacts

steps:
- name: install-core
  pull: always
  image: owncloudci/core
  settings:
    db_host: mysql
    db_name: owncloud
    db_password: owncloud
    db_type: mysql
    db_username: autotest
    version: daily-master-qa

- name: install-app
  pull: always
  image: owncloudci/php:7.1
  commands:
  - make npm
  - cd /var/www/owncloud/
  - php occ a:l
  - php occ a:e contacts
  - php occ a:e testing
  - php occ a:l
  - php occ config:system:set trusted_domains 1 --value=owncloud
  - php occ log:manage --level 0

- name: phpunit-tests
  pull: always
  image: owncloudci/php:7.1
  commands:
  - if [ -z "${COVERAGE}" ]; then make test-php-unit; fi
  - if [ "${COVERAGE}" = "true" ]; then make test-php-unit-dbg; fi
  environment:
    COVERAGE: ${COVERAGE}

- name: notify
  pull: always
  image: plugins/slack:1
  settings:
    channel: builds
  environment:
    SLACK_WEBHOOK:
      from_secret: slack_webhook
  when:
    event:
    - push
    - tag
    status:
    - failure
    - changed

services:
- name: mysql
  pull: if-not-exists
  image: mysql:5.5
  environment:
    MYSQL_DATABASE: owncloud
    MYSQL_PASSWORD: owncloud
    MYSQL_ROOT_PASSWORD: owncloud
    MYSQL_USER: autotest

trigger:
  ref:
  - refs/tags/**
  - refs/pull/**
  - refs/pull-requests/**
  - refs/merge-requests/**
  - refs/heads/master
  - refs/heads/release*
  - refs/heads/release/*

---
kind: pipeline
name: matrix-8

platform:
  os: linux
  arch: amd64

workspace:
  base: /var/www/owncloud
  path: apps/contacts

steps:
- name: install-core
  pull: always
  image: owncloudci/core
  settings:
    db_host: pgsql
    db_name: owncloud
    db_password: owncloud
    db_type: pgsql
    db_username: autotest
    version: daily-master-qa

- name: install-app
  pull: always
  image: owncloudci/php:7.1
  commands:
  - make npm
  - cd /var/www/owncloud/
  - php occ a:l
  - php occ a:e contacts
  - php occ a:e testing
  - php occ a:l
  - php occ config:system:set trusted_domains 1 --value=owncloud
  - php occ log:manage --level 0

- name: phpunit-tests
  pull: always
  image: owncloudci/php:7.1
  commands:
  - if [ -z "${COVERAGE}" ]; then make test-php-unit; fi
  - if [ "${COVERAGE}" = "true" ]; then make test-php-unit-dbg; fi
  environment:
    COVERAGE: ${COVERAGE}

- name: notify
  pull: always
  image: plugins/slack:1
  settings:
    channel: builds
  environment:
    SLACK_WEBHOOK:
      from_secret: slack_webhook
  when:
    event:
    - push
    - tag
    status:
    - failure
    - changed

services:
- name: pgsql
  pull: if-not-exists
  image: postgres:9.4
  environment:
    POSTGRES_DB: owncloud
    POSTGRES_PASSWORD: owncloud
    POSTGRES_USER: autotest

trigger:
  ref:
  - refs/tags/**
  - refs/pull/**
  - refs/pull-requests/**
  - refs/merge-requests/**
  - refs/heads/master
  - refs/heads/release*
  - refs/heads/release/*

---
kind: pipeline
name: matrix-9

platform:
  os: linux
  arch: amd64

workspace:
  base: /var/www/owncloud
  path: apps/contacts

steps:
- name: install-core
  pull: always
  image: owncloudci/core
  settings:
    db_host: oci
    db_name: XE
    db_password: owncloud
    db_type: oci
    db_username: autotest
    version: daily-master-qa

- name: install-app
  pull: always
  image: owncloudci/php:7.1
  commands:
  - make npm
  - cd /var/www/owncloud/
  - php occ a:l
  - php occ a:e contacts
  - php occ a:e testing
  - php occ a:l
  - php occ config:system:set trusted_domains 1 --value=owncloud
  - php occ log:manage --level 0

- name: phpunit-tests
  pull: always
  image: owncloudci/php:7.1
  commands:
  - if [ -z "${COVERAGE}" ]; then make test-php-unit; fi
  - if [ "${COVERAGE}" = "true" ]; then make test-php-unit-dbg; fi
  environment:
    COVERAGE: ${COVERAGE}

- name: notify
  pull: always
  image: plugins/slack:1
  settings:
    channel: builds
  environment:
    SLACK_WEBHOOK:
      from_secret: slack_webhook
  when:
    event:
    - push
    - tag
    status:
    - failure
    - changed

services:
- name: oci
  pull: if-not-exists
  image: deepdiver/docker-oracle-xe-11g
  environment:
    ORACLE_DB: XE
    ORACLE_PASSWORD: oracle
    ORACLE_USER: system

trigger:
  ref:
  - refs/tags/**
  - refs/pull/**
  - refs/pull-requests/**
  - refs/merge-requests/**
  - refs/heads/master
  - refs/heads/release*
  - refs/heads/release/*

---
kind: pipeline
name: matrix-10

platform:
  os: linux
  arch: amd64

workspace:
  base: /var/www/owncloud
  path: apps/contacts

steps:
- name: install-core
  pull: always
  image: owncloudci/core
  settings:
    db_host: mysql
    db_name: owncloud
    db_password: owncloud
    db_type: mysql
    db_username: autotest
    version: daily-master-qa

- name: install-app
  pull: always
  image: owncloudci/php:7.2
  commands:
  - make npm
  - cd /var/www/owncloud/
  - php occ a:l
  - php occ a:e contacts
  - php occ a:e testing
  - php occ a:l
  - php occ config:system:set trusted_domains 1 --value=owncloud
  - php occ log:manage --level 0

- name: phpunit-tests
  pull: always
  image: owncloudci/php:7.2
  commands:
  - if [ -z "${COVERAGE}" ]; then make test-php-unit; fi
  - if [ "${COVERAGE}" = "true" ]; then make test-php-unit-dbg; fi
  environment:
    COVERAGE: ${COVERAGE}

- name: notify
  pull: always
  image: plugins/slack:1
  settings:
    channel: builds
  environment:
    SLACK_WEBHOOK:
      from_secret: slack_webhook
  when:
    event:
    - push
    - tag
    status:
    - failure
    - changed

services:
- name: mysql
  pull: if-not-exists
  image: mysql:5.5
  environment:
    MYSQL_DATABASE: owncloud
    MYSQL_PASSWORD: owncloud
    MYSQL_ROOT_PASSWORD: owncloud
    MYSQL_USER: autotest

trigger:
  ref:
  - refs/tags/**
  - refs/pull/**
  - refs/pull-requests/**
  - refs/merge-requests/**
  - refs/heads/master
  - refs/heads/release*
  - refs/heads/release/*

---
kind: pipeline
name: matrix-11

platform:
  os: linux
  arch: amd64

workspace:
  base: /var/www/owncloud
  path: apps/contacts

steps:
- name: install-core
  pull: always
  image: owncloudci/core
  settings:
    db_host: mysql
    db_name: owncloud
    db_password: owncloud
    db_type: mysql
    db_username: autotest
    version: daily-master-qa

- name: install-app
  pull: always
  image: owncloudci/php:7.3
  commands:
  - make npm
  - cd /var/www/owncloud/
  - php occ a:l
  - php occ a:e contacts
  - php occ a:e testing
  - php occ a:l
  - php occ config:system:set trusted_domains 1 --value=owncloud
  - php occ log:manage --level 0

- name: phpunit-tests
  pull: always
  image: owncloudci/php:7.3
  commands:
  - if [ -z "${COVERAGE}" ]; then make test-php-unit; fi
  - if [ "${COVERAGE}" = "true" ]; then make test-php-unit-dbg; fi
  environment:
    COVERAGE: ${COVERAGE}

- name: notify
  pull: always
  image: plugins/slack:1
  settings:
    channel: builds
  environment:
    SLACK_WEBHOOK:
      from_secret: slack_webhook
  when:
    event:
    - push
    - tag
    status:
    - failure
    - changed

services:
- name: mysql
  pull: if-not-exists
  image: mysql:5.5
  environment:
    MYSQL_DATABASE: owncloud
    MYSQL_PASSWORD: owncloud
    MYSQL_ROOT_PASSWORD: owncloud
    MYSQL_USER: autotest

trigger:
  ref:
  - refs/tags/**
  - refs/pull/**
  - refs/pull-requests/**
  - refs/merge-requests/**
  - refs/heads/master
  - refs/heads/release*
  - refs/heads/release/*

---
kind: pipeline
name: matrix-12

platform:
  os: linux
  arch: amd64

workspace:
  base: /var/www/owncloud
  path: apps/contacts

steps:
- name: install-core
  pull: always
  image: owncloudci/core
  settings:
    db_host: sqlite
    db_name: owncloud
    db_password: owncloud
    db_type: sqlite
    db_username: autotest
    version: daily-master-qa

- name: install-app
  pull: always
  image: owncloudci/php:7.0
  commands:
  - make npm
  - cd /var/www/owncloud/
  - php occ a:l
  - php occ a:e contacts
  - php occ a:e testing
  - php occ a:l
  - php occ config:system:set trusted_domains 1 --value=owncloud
  - php occ log:manage --level 0

- name: phpunit-tests
  pull: always
  image: owncloudci/php:7.0
  commands:
  - if [ -z "${COVERAGE}" ]; then make test-php-unit; fi
  - if [ "${COVERAGE}" = "true" ]; then make test-php-unit-dbg; fi
  environment:
    COVERAGE: ${COVERAGE}

- name: notify
  pull: always
  image: plugins/slack:1
  settings:
    channel: builds
  environment:
    SLACK_WEBHOOK:
      from_secret: slack_webhook
  when:
    event:
    - push
    - tag
    status:
    - failure
    - changed

trigger:
  ref:
  - refs/tags/**
  - refs/pull/**
  - refs/pull-requests/**
  - refs/merge-requests/**
  - refs/heads/master
  - refs/heads/release*
  - refs/heads/release/*

---
kind: pipeline
name: matrix-13

platform:
  os: linux
  arch: amd64

workspace:
  base: /var/www/owncloud
  path: apps/contacts

steps:
- name: install-core
  pull: always
  image: owncloudci/core
  settings:
    db_host: mysql
    db_name: owncloud
    db_password: owncloud
    db_type: mysql
    db_username: autotest
    version: daily-master-qa

- name: install-app
  pull: always
  image: owncloudci/php:7.0
  commands:
  - make npm
  - cd /var/www/owncloud/
  - php occ a:l
  - php occ a:e contacts
  - php occ a:e testing
  - php occ a:l
  - php occ config:system:set trusted_domains 1 --value=owncloud
  - php occ log:manage --level 0

- name: phpunit-tests
  pull: always
  image: owncloudci/php:7.0
  commands:
  - if [ -z "${COVERAGE}" ]; then make test-php-unit; fi
  - if [ "${COVERAGE}" = "true" ]; then make test-php-unit-dbg; fi
  environment:
    COVERAGE: ${COVERAGE}

- name: notify
  pull: always
  image: plugins/slack:1
  settings:
    channel: builds
  environment:
    SLACK_WEBHOOK:
      from_secret: slack_webhook
  when:
    event:
    - push
    - tag
    status:
    - failure
    - changed

services:
- name: mysql
  pull: if-not-exists
  image: mysql:5.5
  environment:
    MYSQL_DATABASE: owncloud
    MYSQL_PASSWORD: owncloud
    MYSQL_ROOT_PASSWORD: owncloud
    MYSQL_USER: autotest

trigger:
  ref:
  - refs/tags/**
  - refs/pull/**
  - refs/pull-requests/**
  - refs/merge-requests/**
  - refs/heads/master
  - refs/heads/release*
  - refs/heads/release/*

---
kind: pipeline
name: matrix-14

platform:
  os: linux
  arch: amd64

workspace:
  base: /var/www/owncloud
  path: apps/contacts

steps:
- name: install-core
  pull: always
  image: owncloudci/core
  settings:
    db_host: pgsql
    db_name: owncloud
    db_password: owncloud
    db_type: pgsql
    db_username: autotest
    version: daily-master-qa

- name: install-app
  pull: always
  image: owncloudci/php:7.0
  commands:
  - make npm
  - cd /var/www/owncloud/
  - php occ a:l
  - php occ a:e contacts
  - php occ a:e testing
  - php occ a:l
  - php occ config:system:set trusted_domains 1 --value=owncloud
  - php occ log:manage --level 0

- name: phpunit-tests
  pull: always
  image: owncloudci/php:7.0
  commands:
  - if [ -z "true" ]; then make test-php-unit; fi
  - if [ "true" = "true" ]; then make test-php-unit-dbg; fi
  environment:
    COVERAGE: true

- name: codecov
  pull: always
  image: plugins/codecov:2
  settings:
    paths:
    - tests/output/*.xml
  environment:
    CODECOV_TOKEN:
      from_secret: codecov_token

- name: notify
  pull: always
  image: plugins/slack:1
  settings:
    channel: builds
  environment:
    SLACK_WEBHOOK:
      from_secret: slack_webhook
  when:
    event:
    - push
    - tag
    status:
    - failure
    - changed

services:
- name: pgsql
  pull: if-not-exists
  image: postgres:9.4
  environment:
    POSTGRES_DB: owncloud
    POSTGRES_PASSWORD: owncloud
    POSTGRES_USER: autotest

trigger:
  ref:
  - refs/tags/**
  - refs/pull/**
  - refs/pull-requests/**
  - refs/merge-requests/**
  - refs/heads/master
  - refs/heads/release*
  - refs/heads/release/*

---
kind: pipeline
name: matrix-15

platform:
  os: linux
  arch: amd64

workspace:
  base: /var/www/owncloud
  path: apps/contacts

steps:
- name: install-core
  pull: always
  image: owncloudci/core
  settings:
    db_host: oci
    db_name: XE
    db_password: owncloud
    db_type: oci
    db_username: autotest
    version: daily-master-qa

- name: install-app
  pull: always
  image: owncloudci/php:7.0
  commands:
  - make npm
  - cd /var/www/owncloud/
  - php occ a:l
  - php occ a:e contacts
  - php occ a:e testing
  - php occ a:l
  - php occ config:system:set trusted_domains 1 --value=owncloud
  - php occ log:manage --level 0

- name: phpunit-tests
  pull: always
  image: owncloudci/php:7.0
  commands:
  - if [ -z "${COVERAGE}" ]; then make test-php-unit; fi
  - if [ "${COVERAGE}" = "true" ]; then make test-php-unit-dbg; fi
  environment:
    COVERAGE: ${COVERAGE}

- name: notify
  pull: always
  image: plugins/slack:1
  settings:
    channel: builds
  environment:
    SLACK_WEBHOOK:
      from_secret: slack_webhook
  when:
    event:
    - push
    - tag
    status:
    - failure
    - changed

services:
- name: oci
  pull: if-not-exists
  image: deepdiver/docker-oracle-xe-11g
  environment:
    ORACLE_DB: XE
    ORACLE_PASSWORD: oracle
    ORACLE_USER: system

trigger:
  ref:
  - refs/tags/**
  - refs/pull/**
  - refs/pull-requests/**
  - refs/merge-requests/**
  - refs/heads/master
  - refs/heads/release*
  - refs/heads/release/*

---
kind: pipeline
name: matrix-16

platform:
  os: linux
  arch: amd64

workspace:
  base: /var/www/owncloud
  path: apps/contacts

steps:
- name: install-core
  pull: always
  image: owncloudci/core
  settings:
    db_host: sqlite
    db_name: owncloud
    db_password: owncloud
    db_type: sqlite
    db_username: autotest
    version: daily-master-qa

- name: install-app
  pull: always
  image: owncloudci/php:7.1
  commands:
  - make npm
  - cd /var/www/owncloud/
  - php occ a:l
  - php occ a:e contacts
  - php occ a:e testing
  - php occ a:l
  - php occ config:system:set trusted_domains 1 --value=owncloud
  - php occ log:manage --level 0

- name: integration-tests
  pull: always
  image: owncloudci/php:7.1
  commands:
  - if [ -z "${COVERAGE}" ]; then make test-php-integration; fi
  - if [ "${COVERAGE}" = "true" ]; then make test-php-integration-dbg; fi
  environment:
    COVERAGE: ${COVERAGE}

- name: notify
  pull: always
  image: plugins/slack:1
  settings:
    channel: builds
  environment:
    SLACK_WEBHOOK:
      from_secret: slack_webhook
  when:
    event:
    - push
    - tag
    status:
    - failure
    - changed

trigger:
  ref:
  - refs/tags/**
  - refs/pull/**
  - refs/pull-requests/**
  - refs/merge-requests/**
  - refs/heads/master
  - refs/heads/release*
  - refs/heads/release/*

---
kind: pipeline
name: matrix-17

platform:
  os: linux
  arch: amd64

workspace:
  base: /var/www/owncloud
  path: apps/contacts

steps:
- name: install-core
  pull: always
  image: owncloudci/core
  settings:
    db_host: mysql
    db_name: owncloud
    db_password: owncloud
    db_type: mysql
    db_username: autotest
    version: daily-master-qa

- name: install-app
  pull: always
  image: owncloudci/php:7.1
  commands:
  - make npm
  - cd /var/www/owncloud/
  - php occ a:l
  - php occ a:e contacts
  - php occ a:e testing
  - php occ a:l
  - php occ config:system:set trusted_domains 1 --value=owncloud
  - php occ log:manage --level 0

- name: integration-tests
  pull: always
  image: owncloudci/php:7.1
  commands:
  - if [ -z "${COVERAGE}" ]; then make test-php-integration; fi
  - if [ "${COVERAGE}" = "true" ]; then make test-php-integration-dbg; fi
  environment:
    COVERAGE: ${COVERAGE}

- name: notify
  pull: always
  image: plugins/slack:1
  settings:
    channel: builds
  environment:
    SLACK_WEBHOOK:
      from_secret: slack_webhook
  when:
    event:
    - push
    - tag
    status:
    - failure
    - changed

services:
- name: mysql
  pull: if-not-exists
  image: mysql:5.5
  environment:
    MYSQL_DATABASE: owncloud
    MYSQL_PASSWORD: owncloud
    MYSQL_ROOT_PASSWORD: owncloud
    MYSQL_USER: autotest

trigger:
  ref:
  - refs/tags/**
  - refs/pull/**
  - refs/pull-requests/**
  - refs/merge-requests/**
  - refs/heads/master
  - refs/heads/release*
  - refs/heads/release/*

---
kind: pipeline
name: matrix-18

platform:
  os: linux
  arch: amd64

workspace:
  base: /var/www/owncloud
  path: apps/contacts

steps:
- name: install-core
  pull: always
  image: owncloudci/core
  settings:
    db_host: pgsql
    db_name: owncloud
    db_password: owncloud
    db_type: pgsql
    db_username: autotest
    version: daily-master-qa

- name: install-app
  pull: always
  image: owncloudci/php:7.1
  commands:
  - make npm
  - cd /var/www/owncloud/
  - php occ a:l
  - php occ a:e contacts
  - php occ a:e testing
  - php occ a:l
  - php occ config:system:set trusted_domains 1 --value=owncloud
  - php occ log:manage --level 0

- name: integration-tests
  pull: always
  image: owncloudci/php:7.1
  commands:
  - if [ -z "${COVERAGE}" ]; then make test-php-integration; fi
  - if [ "${COVERAGE}" = "true" ]; then make test-php-integration-dbg; fi
  environment:
    COVERAGE: ${COVERAGE}

- name: notify
  pull: always
  image: plugins/slack:1
  settings:
    channel: builds
  environment:
    SLACK_WEBHOOK:
      from_secret: slack_webhook
  when:
    event:
    - push
    - tag
    status:
    - failure
    - changed

services:
- name: pgsql
  pull: if-not-exists
  image: postgres:9.4
  environment:
    POSTGRES_DB: owncloud
    POSTGRES_PASSWORD: owncloud
    POSTGRES_USER: autotest

trigger:
  ref:
  - refs/tags/**
  - refs/pull/**
  - refs/pull-requests/**
  - refs/merge-requests/**
  - refs/heads/master
  - refs/heads/release*
  - refs/heads/release/*

---
kind: pipeline
name: matrix-19

platform:
  os: linux
  arch: amd64

workspace:
  base: /var/www/owncloud
  path: apps/contacts

steps:
- name: install-core
  pull: always
  image: owncloudci/core
  settings:
    db_host: oci
    db_name: XE
    db_password: owncloud
    db_type: oci
    db_username: autotest
    version: daily-master-qa

- name: install-app
  pull: always
  image: owncloudci/php:7.1
  commands:
  - make npm
  - cd /var/www/owncloud/
  - php occ a:l
  - php occ a:e contacts
  - php occ a:e testing
  - php occ a:l
  - php occ config:system:set trusted_domains 1 --value=owncloud
  - php occ log:manage --level 0

- name: integration-tests
  pull: always
  image: owncloudci/php:7.1
  commands:
  - if [ -z "${COVERAGE}" ]; then make test-php-integration; fi
  - if [ "${COVERAGE}" = "true" ]; then make test-php-integration-dbg; fi
  environment:
    COVERAGE: ${COVERAGE}

- name: notify
  pull: always
  image: plugins/slack:1
  settings:
    channel: builds
  environment:
    SLACK_WEBHOOK:
      from_secret: slack_webhook
  when:
    event:
    - push
    - tag
    status:
    - failure
    - changed

services:
- name: oci
  pull: if-not-exists
  image: deepdiver/docker-oracle-xe-11g
  environment:
    ORACLE_DB: XE
    ORACLE_PASSWORD: oracle
    ORACLE_USER: system

trigger:
  ref:
  - refs/tags/**
  - refs/pull/**
  - refs/pull-requests/**
  - refs/merge-requests/**
  - refs/heads/master
  - refs/heads/release*
  - refs/heads/release/*

---
kind: pipeline
name: matrix-20

platform:
  os: linux
  arch: amd64

workspace:
  base: /var/www/owncloud
  path: apps/contacts

steps:
- name: install-core
  pull: always
  image: owncloudci/core
  settings:
    db_host: mysql
    db_name: owncloud
    db_password: owncloud
    db_type: mysql
    db_username: autotest
    version: daily-master-qa

- name: install-app
  pull: always
  image: owncloudci/php:7.2
  commands:
  - make npm
  - cd /var/www/owncloud/
  - php occ a:l
  - php occ a:e contacts
  - php occ a:e testing
  - php occ a:l
  - php occ config:system:set trusted_domains 1 --value=owncloud
  - php occ log:manage --level 0

- name: integration-tests
  pull: always
  image: owncloudci/php:7.2
  commands:
  - if [ -z "${COVERAGE}" ]; then make test-php-integration; fi
  - if [ "${COVERAGE}" = "true" ]; then make test-php-integration-dbg; fi
  environment:
    COVERAGE: ${COVERAGE}

- name: notify
  pull: always
  image: plugins/slack:1
  settings:
    channel: builds
  environment:
    SLACK_WEBHOOK:
      from_secret: slack_webhook
  when:
    event:
    - push
    - tag
    status:
    - failure
    - changed

services:
- name: mysql
  pull: if-not-exists
  image: mysql:5.5
  environment:
    MYSQL_DATABASE: owncloud
    MYSQL_PASSWORD: owncloud
    MYSQL_ROOT_PASSWORD: owncloud
    MYSQL_USER: autotest

trigger:
  ref:
  - refs/tags/**
  - refs/pull/**
  - refs/pull-requests/**
  - refs/merge-requests/**
  - refs/heads/master
  - refs/heads/release*
  - refs/heads/release/*

---
kind: pipeline
name: matrix-21

platform:
  os: linux
  arch: amd64

workspace:
  base: /var/www/owncloud
  path: apps/contacts

steps:
- name: install-core
  pull: always
  image: owncloudci/core
  settings:
    db_host: sqlite
    db_name: owncloud
    db_password: owncloud
    db_type: sqlite
    db_username: autotest
    version: daily-master-qa

- name: install-app
  pull: always
  image: owncloudci/php:7.0
  commands:
  - make npm
  - cd /var/www/owncloud/
  - php occ a:l
  - php occ a:e contacts
  - php occ a:e testing
  - php occ a:l
  - php occ config:system:set trusted_domains 1 --value=owncloud
  - php occ log:manage --level 0

- name: integration-tests
  pull: always
  image: owncloudci/php:7.0
  commands:
  - if [ -z "${COVERAGE}" ]; then make test-php-integration; fi
  - if [ "${COVERAGE}" = "true" ]; then make test-php-integration-dbg; fi
  environment:
    COVERAGE: ${COVERAGE}

- name: notify
  pull: always
  image: plugins/slack:1
  settings:
    channel: builds
  environment:
    SLACK_WEBHOOK:
      from_secret: slack_webhook
  when:
    event:
    - push
    - tag
    status:
    - failure
    - changed

trigger:
  ref:
  - refs/tags/**
  - refs/pull/**
  - refs/pull-requests/**
  - refs/merge-requests/**
  - refs/heads/master
  - refs/heads/release*
  - refs/heads/release/*

---
kind: pipeline
name: matrix-22

platform:
  os: linux
  arch: amd64

workspace:
  base: /var/www/owncloud
  path: apps/contacts

steps:
- name: install-core
  pull: always
  image: owncloudci/core
  settings:
    db_host: mysql
    db_name: owncloud
    db_password: owncloud
    db_type: mysql
    db_username: autotest
    version: daily-master-qa

- name: install-app
  pull: always
  image: owncloudci/php:7.0
  commands:
  - make npm
  - cd /var/www/owncloud/
  - php occ a:l
  - php occ a:e contacts
  - php occ a:e testing
  - php occ a:l
  - php occ config:system:set trusted_domains 1 --value=owncloud
  - php occ log:manage --level 0

- name: integration-tests
  pull: always
  image: owncloudci/php:7.0
  commands:
  - if [ -z "${COVERAGE}" ]; then make test-php-integration; fi
  - if [ "${COVERAGE}" = "true" ]; then make test-php-integration-dbg; fi
  environment:
    COVERAGE: ${COVERAGE}

- name: notify
  pull: always
  image: plugins/slack:1
  settings:
    channel: builds
  environment:
    SLACK_WEBHOOK:
      from_secret: slack_webhook
  when:
    event:
    - push
    - tag
    status:
    - failure
    - changed

services:
- name: mysql
  pull: if-not-exists
  image: mysql:5.5
  environment:
    MYSQL_DATABASE: owncloud
    MYSQL_PASSWORD: owncloud
    MYSQL_ROOT_PASSWORD: owncloud
    MYSQL_USER: autotest

trigger:
  ref:
  - refs/tags/**
  - refs/pull/**
  - refs/pull-requests/**
  - refs/merge-requests/**
  - refs/heads/master
  - refs/heads/release*
  - refs/heads/release/*

---
kind: pipeline
name: matrix-23

platform:
  os: linux
  arch: amd64

workspace:
  base: /var/www/owncloud
  path: apps/contacts

steps:
- name: install-core
  pull: always
  image: owncloudci/core
  settings:
    db_host: pgsql
    db_name: owncloud
    db_password: owncloud
    db_type: pgsql
    db_username: autotest
    version: daily-master-qa

- name: install-app
  pull: always
  image: owncloudci/php:7.0
  commands:
  - make npm
  - cd /var/www/owncloud/
  - php occ a:l
  - php occ a:e contacts
  - php occ a:e testing
  - php occ a:l
  - php occ config:system:set trusted_domains 1 --value=owncloud
  - php occ log:manage --level 0

- name: integration-tests
  pull: always
  image: owncloudci/php:7.0
  commands:
  - if [ -z "${COVERAGE}" ]; then make test-php-integration; fi
  - if [ "${COVERAGE}" = "true" ]; then make test-php-integration-dbg; fi
  environment:
    COVERAGE: ${COVERAGE}

- name: notify
  pull: always
  image: plugins/slack:1
  settings:
    channel: builds
  environment:
    SLACK_WEBHOOK:
      from_secret: slack_webhook
  when:
    event:
    - push
    - tag
    status:
    - failure
    - changed

services:
- name: pgsql
  pull: if-not-exists
  image: postgres:9.4
  environment:
    POSTGRES_DB: owncloud
    POSTGRES_PASSWORD: owncloud
    POSTGRES_USER: autotest

trigger:
  ref:
  - refs/tags/**
  - refs/pull/**
  - refs/pull-requests/**
  - refs/merge-requests/**
  - refs/heads/master
  - refs/heads/release*
  - refs/heads/release/*

---
kind: pipeline
name: matrix-24

platform:
  os: linux
  arch: amd64

workspace:
  base: /var/www/owncloud
  path: apps/contacts

steps:
- name: install-core
  pull: always
  image: owncloudci/core
  settings:
    db_host: oci
    db_name: XE
    db_password: owncloud
    db_type: oci
    db_username: autotest
    version: daily-master-qa

- name: install-app
  pull: always
  image: owncloudci/php:7.0
  commands:
  - make npm
  - cd /var/www/owncloud/
  - php occ a:l
  - php occ a:e contacts
  - php occ a:e testing
  - php occ a:l
  - php occ config:system:set trusted_domains 1 --value=owncloud
  - php occ log:manage --level 0

- name: integration-tests
  pull: always
  image: owncloudci/php:7.0
  commands:
  - if [ -z "${COVERAGE}" ]; then make test-php-integration; fi
  - if [ "${COVERAGE}" = "true" ]; then make test-php-integration-dbg; fi
  environment:
    COVERAGE: ${COVERAGE}

- name: notify
  pull: always
  image: plugins/slack:1
  settings:
    channel: builds
  environment:
    SLACK_WEBHOOK:
      from_secret: slack_webhook
  when:
    event:
    - push
    - tag
    status:
    - failure
    - changed

services:
- name: oci
  pull: if-not-exists
  image: deepdiver/docker-oracle-xe-11g
  environment:
    ORACLE_DB: XE
    ORACLE_PASSWORD: oracle
    ORACLE_USER: system

trigger:
  ref:
  - refs/tags/**
  - refs/pull/**
  - refs/pull-requests/**
  - refs/merge-requests/**
  - refs/heads/master
  - refs/heads/release*
  - refs/heads/release/*

...
